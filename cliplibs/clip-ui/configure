#!/bin/sh

# This configure script is free software; the Free Software Foundation
# gives unlimited permission to copy, distribute and modify it.

# Defaults:
ac_default_prefix=${CLIPROOT-/usr/local}
prefix=$ac_default_prefix
debug=
SHELL=${CONFIG_SHELL-/bin/sh}
DBDEFS=
ac_prev=
bindir=$prefix/bin
libdir=$prefix/lib

for ac_option
do
  # If the previous option needs an argument, assign it.
  if test -n "$ac_prev"; then
    eval "$ac_prev=\$ac_option"
    ac_prev=
    continue
  fi

  case "$ac_option" in
  -*=*) ac_optarg=`echo "$ac_option" | sed 's/[-_a-zA-Z0-9]*=//'` ;;
  *) ac_optarg= ;;
  esac

  # Accept the important Cygnus configure options, so we can diagnose typos.
echo "$ac_option"
  case "$ac_option" in

  --debug)
    debug=YES ;;

  --bindir)
    ac_prev=bindir ;;
  --bindir=*)
    bindir="$ac_optarg" ;;

  --prefix)
    ac_prev=prefix ;;
  --prefix=*)
    prefix="$ac_optarg"
    bindir=$prefix/bin
    libdir=$prefix/lib ;;

  --libdir)
    ac_prev=libdir ;;
  --libdir=*)
    libdir="$ac_optarg" ;;

  -h | --help)
    cat <<EOF
Usage: configure [options]
Options:
  --help                  print this message
  --debug		  enable debug [default=no]
  --prefix=PREFIX         install architecture-independent files in PREFIX [$ac_default_prefix]
  --bindir=DIR		  where install executables files [$bindir]
  --libdir=DIR		  where install library files [$libdir]
EOF
    exit 0 ;;
  esac
done

# File descriptor usage:
# 0 standard input
# 1 file creation
# 2 errors and warnings
# 3 some systems may open it to /dev/tty
# 4 used on the Kubota Titan
# 6 checking for... messages and results
# 5 compiler messages saved in config.log
if test "$silent" = yes; then
  exec 6>/dev/null
else
  exec 6>&1
fi
exec 5>./config.log

echo "\
This file contains any messages produced by compilers while
running configure, to aid debugging if configure makes a mistake.
" 1>&5

ac_n=-n

# Check make
echo $ac_n "checking whether ${MAKE-make} sets \${MAKE}""... $ac_c" 1>&6
echo "configure:92: checking whether ${MAKE-make} sets \${MAKE}" >&5
set dummy ${MAKE-make}; ac_make=`echo "$2" | sed 'y%./+-%__p_%'`
if eval "test \"`echo '$''{'ac_cv_prog_make_${ac_make}_set'+set}'`\" = set"; then
  echo $ac_n "(cached) $ac_c" 1>&6
else
  cat > conftestmake <<\EOF
all:
	@echo 'ac_maketemp="${MAKE}"'
EOF
# GNU make sometimes prints "make[1]: Entering...", which would confuse us.
eval `${MAKE-make} -f conftestmake 2>/dev/null | grep temp=`
if test -n "$ac_maketemp"; then
  eval ac_cv_prog_make_${ac_make}_set=yes
else
  eval ac_cv_prog_make_${ac_make}_set=no
fi
rm -f conftestmake
fi
if eval "test \"`echo '$ac_cv_prog_make_'${ac_make}_set`\" = yes"; then
  echo "$ac_t""yes" 1>&6
  SET_MAKE=
else
  echo "$ac_t""no" 1>&6
  SET_MAKE="MAKE=${MAKE-make}"
fi

# Check $CLIPROOT
echo $ac_n "checking for a CLIP""... $ac_c" 1>&6
echo "configure:120: checking for a CLIP" >&5

if test -z "$CLIPROOT"; then
	echo "CLIP installation does not found. Install CLIP from http://www.itk.ru or set \$CLIPROOT correct." 2>&6
	exit
fi
echo "$CLIPROOT"

# Check CLIP compiler
echo $ac_n "checking for a CLIP compiler""... $ac_c" 1>&6
echo "configure:130: checking for a CLIP compiler" >&5

prg=$CLIPROOT/bin/clip
if test ! -x "$prg"; then
	echo "CLIP compiler '$prg' does not found. Install CLIP from http://www.itk.ru." 2>&6
	exit
fi
CLIP_version=`$prg --version | sed -n '1p' | tr -d '\n'`
echo "$CLIP_version"

# Check clip-gtk
echo $ac_n "checking for a clip-gtk library""... $ac_c" 1>&6
echo "configure:142: checking for a clip-gtk" >&5

prg=$CLIPROOT/lib/libclip-gtk.so
if test ! -f "$prg"; then
	echo "Library '$prg' does not found. Configure and install clip-gtk from clip-gtk subdirectory." 2>&6
	exit
fi
echo "yes"

# Check clip-gtkextra
#echo $ac_n "checking for a clip-gtkextra library""... $ac_c" 1>&6
#echo "configure:161: checking for a clip-gtkextra" >&5

#prg=$CLIPROOT/lib/libclip-gtkextra.so
#if test ! -f "$prg"; then
#	echo "Library '$prg' does not found. Configure and install clip-gtkextra from CLIPDISTRO/cliplibs/clip-gtkextra directory or appropriate binary package." 2>&6
#	exit
#fi
#echo "yes"

#rm -f conftest*
CXXFLAGS="$ac_cxxflags_safe"
LDFLAGS="$ac_ldflags_safe"
LIBS="$ac_libs_safe"


echo ""
echo "Pathes to installed components:"
echo -e "\tExecutables:\t$bindir"
echo -e "\tLibrary:\t$libdir"
echo ""

sedline="s%@SHELL@%$SHELL%"
echo "Create Makefile..." >&6
echo "configure:176: Create Makefile..." >&5

echo "# Makefile for clip-ui custom variables" >Makefile.var
echo "RBINDIR=$bindir" >>Makefile.var
echo "RLIBDIR=$libdir" >>Makefile.var

cat Makefile.var Makefile.in >Makefile
