<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<HTML>
<HEAD>
<meta http-equiv="Content-Type" content="text/html; charset=koi8-r">
<LINK REL=STYLESHEET TYPE="text/css" HREF="styl.css">
<LINK REL=STYLESHEET TYPE="text/css" HREF="styl.css">
<TITLE>Clipper compiler</TITLE>
</HEAD>
<BODY>

<h3>             Описание класса URL </h3>

Производит буферизованное и кеширующее чтение укзанного URL из глобальной
сети. Суть заключается в том, что на самом деле чтение данных производит
программа WGET, а данный класс всего лишь "обертка" вокруг WGET.
Класс позволяет читать данные из сети и использовать неполностью считанные
данные в любой момент времени без остановки как процесса чтения данных
из сети так и данных из закешированного файла.

<BR>
Простенький пример использования:
<PRE>
// открыть URL
u=urlNew("http","www.itk.ru","/clipper","index.html")
u:open()
while !u:eof() // пока не закончился процесс чтения данных из сети
   ? u:status
   // здесь еще можно timeout вкрутить
   u:kick // обновить статус процесса "выкачки"
   sleep(1)
   // или вместо sleep можно начать обрабатывать частично закачанные
   // данные из сети
   do while !u:fileEof()
       ? u:getstr()
   enddo
   u:goTop()
enddo
  // процесс "закачки" закончился - можно преваривать полученный файл
  // такой же цикл можно использовать и вместо sleep(1)
  // только надо быть осторожным чтоб не уйти в бесконечность.
u:goTop()
while !u:dataEof()
  ? u:getStr(1000)
enddo
</PRE>


<h3> Атрибуты/свойства </H3>

<h3> Атрибуты/свойства </H3>
<TABLE border=1>
<th> Название атрибута </TH>
<th> Значение атрибута </TH>
<TR>
<td> protocol </td> <TD> "http" | "ftp" | "file" </TD>
<TR>
<td> port </td> <TD> NIL | numeric </TD>
<TR>
<td> user </td> <TD> NIL | string </TD>
<TR>
<td> password </td> <TD> NIL | string </TD>
<tr>
<td> host </td> <TD> адрес сайта в виде строки "www.itk.ru" или строки с IP-номером </TD>
<tr>
<td> path </td> <TD> каталог на сайте </TD>
<tr>
<td> file </td> <TD> имя файла на сайте </TD>
<tr>
<td> anchor </td> <TD> якорь </TD>
<TR>
<td> params </td> <TD> NIL | string </TD>
<tr>
<td> start </td> <TD> число секунд системного времени (результат работы функции seconds) в момент
начала считывания URL </TD>
<tr>
<td> stop </td> <TD> число секунд системного времени (результат работы функции seconds) в момент
окончания считывания URL </TD>
<tr>
<td> status </td> <TD> строковое сообщение о текущем состоянии процесса скачивания </TD>
<tr>
<td> messages </td> <TD> строка со всеми сообщениями, выдававшиеся программой WGET </TD>
<tr>
<td> length </td> <TD> предполагаемая длина выкачиваемого файла </TD>
<tr>
<td> ready </td> <TD> сколько байт реально скачано </TD>
</TABLE>

<h3> Методы/функции </H3>
<h4> функция urlNew </h4>
urlNew(protocol,host,path,file) - инициализирует новый URL. <BR>
urlNew(url_OBJ) - инициализурует новый URL из структуры url_OBJ, например
можно унаследовать свойства родительской страницы.
<h4> метод url:parseUrl(url) </h4>
Разбирает строку с URL в формате:
[protocol:][//user:password@][host][/path/]file[?params][#anchor]
раскладывает значения по атрибутам объекта. Старые значения атрибутов,
не указанные в анализируемом URL не уничтожаются - т.е. используются как
значения по умолчанию.
<h4> метод url:makeUrl(url) </h4>
Возвращает строку, собрнную из атрибутов объекта
<h4> метод url:open() </h4>
Начать процесс закачки.
<h4> метод url:close() </h4>
Закончить процесс закачки, даже если еще не все данные приняты.
<h4> метод url:eof() </h4>
Закончился ли процесс скачивания.
<h4> метод url:kick() </h4>
Обновить статусы процесса скачивания.
<h4> метод url:kick() </h4>
Обновить статусы процесса скачивания.
<h4> метод url:goTop() </h4>
Начать процесс чтения скаченных данных из закешированного файла.
<h4> метод url:read() </h4>
read(@buffer,nBytes) - прочитать в buffer скачанные данные в размере nBytes,
возвращает реально прочитанное кол-во байт. Аналогично функции fread.
<h4> метод url:readStr(nBytes) </h4>
readStr(@buffer) - прочитать nBytes из скачанного файла и вернуть их в
виде строки. Аналогично функции freadStr.
<h4> метод url:getStr(nBytes) </h4>
readStr(@buffer) - прочитать из скачанного файла строку, ограниченную символами
конца строки. Аналогично функции fileGetStr.
<h4> метод url:fileEof() </h4>
Достигнут ли конец закешированного файла в процессе чтения, это не означает
что процесс скачивания уже закончился. Это означает что все скачанные
данные прочитаны методами read*
<h4> метод url:dataEof() </h4>
А вот это означает что процесс скачивания закончился и все данные из
закешированного файла прочитаны функциями read*

<center>&#169 Ю.Хныкин, <A HREF="mailto:uri@itk.ru">uri@itk.ru</A>, 2000
</center>
</body>
</html>
