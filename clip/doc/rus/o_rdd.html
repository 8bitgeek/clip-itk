<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<HTML>
<HEAD>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<LINK REL=STYLESHEET TYPE="text/css" HREF="styl.css">
<TITLE>Clipper compiler</TITLE>
</HEAD>
<BODY>

<h2>             Описание класса RDD </h2>
Класс для работы с данными. Хранит в атрибуте <B>handle</B> дескриптор открытой таблицы.
Позволяет создавать объекты и работать с данными без использования алиасов.

<BR>
Пример:
<PRE>
// Создать объект
  r:=RDDNew()
// Открыть таблицу и индекс
  r:open("DBF","table1.dbf")
  r:setindex("NTX","table1.ntx")
// Создание объекта и сразу открытие таблицы
  r2:=RDDNew(,"table2.dbf")
  r2:setindex(,"table2.ntx")
// Установить отношение
  r:setrelation(r2,"str(field1,1)+str(field2,10)")
  r:gotop()
// Вывести в цикле поля обеих таблиц
  while .not. r:eof()
    Rec:=r:read()
    Rec2:=r2:read()
    ? Rec:field1+", "+Rec:field2+", "+Rec2:field2
    r:skip()
  enddo
// Закрыть таблицы
  r:close()
  r2:close()
</PRE>
<h3> Атрибуты/свойства </H3>
<TABLE border=1>
<th> Название атрибута </TH>
<th> Значение атрибута </TH>
<TR>
<td align=center> <big> handle </big></td>
  <TD> Дескриптор открытой таблицы данных. Если таблица не открыта
  или уже закрыта, равен NIL </TD>
<TR>
<td align=center> <big> table_driver </big></td>
  <TD> Имя драйвера таблиц данных по умолчанию.
  При создании объекта <b>table_driver="DBF"</b>.</TD>
<TR>
<td align=center> <big> index_driver </big></td>
  <TD> Имя драйвера индексных файлов по умолчанию.
  При создании объекта <b>index_driver="NTX"</b>.</TD>
<TR>
<td align=center> <big> memo_driver </big></td>
  <TD> Имя драйвера мемо-файлов по умолчанию.
  При создании объекта <b>memo_driver="DBT"</b>.</TD>
<TR>
<td align=center> <big> shared </big></td>
  <TD> Режим открытия таблиц по умолчанию (Совместный доступ/Эксклюзивный режим).
  При создании объекта <b>shared=.t.</b> (Таблицы открываются в разделяемом режиме).</TD>
<TR>
<td align=center> <big> read_only </big></td>
  <TD> Режим открытия таблиц по умолчанию (Только для чтения/Для чтения-записи).
  При создании объекта <b>read_only=.f.</b> (Таблицы открываются для чтения-записи).</TD>
<TR>
<td align=center> <big> soft_seek </big></td>
  <TD> Режим индексного поиска по умолчанию.
  При создании объекта <b>soft_seek=.t.</b> (Если не нашли - встаем на
  ближайший больший ключ).</TD>
<TR>
<td align=center> <big> search_result </big></td>
  <TD> Хранит результат последнего поиска. Также доступно через метод <b>found()</b></TD>
<TR>
</TABLE>

<h3> Методы </H3>


<h4> append() </h4>
Добавляет пустую запись.
<hr>
<h4> bof() </h4>
Возвращает <B>.t.</B> при достижении начала файла, иначе <B>.f.</B>.
<hr>
<h4> browse(top,left,down,right, fields, user_func, picts, headers, hsep,csep,fsep, footers) </h4>
Отображает данные в табличной форме, позволяет перемещаться по ним и просматривать
(не позволяет редактировать). <br>
<b>top,left,down,right</b> - координаты окна, в котором отображается <br>
<b>fields</b> - массив, блоки кода,используемые как значения колонок для каждой выводимой
строки.  Если этот аргумент не определен, browse() выводит информацию всех полей таблицы,
размещая ее по колонкам.<br>
<b>user_func</b> - имя функции пользователя, которой передается управление при нажатии
неопределенной клавиши или если клавиша не нажата.  Имя функции определяется в виде
символьного выражения без круглых скобок и аргументов. Поведение browse() зависит от того,
определена функция пользователя или нет.<br>
<b>picts</b> - параллельный массив, содержащий предложения PICTURE для форматирования
каждой колонки. Если определить <b>picts</b> не в виде массива, а в виде строки,
информация всех колонок будет выводиться в одном и том же формате.<br>
<b>headers</b> - параллельный массив, содержащий символьные выражения, которые
определяют заголовки каждой колонки. Для выдачи заголовков для отдельных колонок
необходимо включить точку с запятой в выражение заголовка там, где требуется перенести
текст на другую строку. Если параметр не задан, заголовки колонок выбираются из
массива <b>fields</b> или заполняются именами полей текущей таблицы, если массив
<b>fields</b> также не задан.<br>
<b>hsep</b> - это параллельный массив, содержащий символьные выражения, символы,
используемые для рисования горизонтальных линий, отделяющих заголовки колонок от
области выдачи информации полей.
Если задать <b>hsep</b> в виде строки, будет использован один и тот же разделитель
для всех колонок.  Если аргумент не задан, по умолчанию принимается двойная линия.<br>
<b>csep</b> - это параллельный массив, содержащий символьные выражения, символы,
используемые для рисования вертикальных линий, разделяющих колонки.
Если задать <b>csep</b> в виде строки, будет использован один и тот же разделитель
для всех колонок.  Если аргумент не задан, по умолчанию принимается вертикальная линия.<br>
<b>fsep</b> - параллельный массив, содержащий символьные выражения, которые определяют
символы, используемые для рисования разделителей между завершающими колонки подписями и
информацией полей.
Если задать <b>fsep</b> в виде строки, будет использован один и тот же разделитель
для всех колонок.  Если аргумент не задан, по умолчанию принимается отсутствие
разделителя (пробел).<br>
<b>footer</b> - параллельный массив, содержащий символьные выражения, завершающие
подписи для каждой колонки. Если аргумент задать не в виде массива, в качестве
завершающей подписи для всех колонок будет использоваться одно и то же значение.<br>
<hr>
<h4> clearindex() </h4>
Закрывет все индексные файлы.
<hr>
<h4> close() </h4>
Закрывает таблицу данных. Атрибут <b>handle</b> устанавливается в NIL.
<hr>
<h4> continue() </h4>
Продолжает поиск, заданный в методе locate(). При этом применяется только
условия поиска, никакие дополнительные параметры locate() не используются.
<hr>
<h4> create(Driver,FName,Stru) </h4>
Создает таблицу данных со структурой, заданной в массиве <b>Stru</b>.<br>
<b>Driver</b> - имя RDD-драйвера таблицы, <b>FName</b> - имя файла.
<hr>
<h4> createindex(Driver,Name,Tag,Expr,Unique) </h4>
Создает индекс.<br>
<b>Driver</b> - имя RDD-драйвера индексного файла.<br>
<B>Name</B> - имя индексного файла.<br>
<B>Tag</B> - имя тэга индекса.<br>
<B>Expr</B> - индексное выражение.<br>
<B>Unique</B> - определяет, создается индекс с уникальными ключами или нет.<br>
<hr>
<h4> creatememo(Driver,Name) </h4>
Создает MEMO-файл.<br>
<B>Driver</B> - имя RDD-драйвера MEMO-файла.<br>
<B>Name</B> - имя MEMO-файла.<br>
<hr>
<h4> deleted() </h4>
Влзвращает логическое значение, определяющее,
помечена ли текущая запись для удаления или нет.
<hr>
<h4> delete() </h4>
Помечает текущую запись для удаления.
<hr>
<h4> eof() </h4>
Возвращает <B>.t.</B> при достижении конца файла, иначе <B>.f.</B>.
<hr>
<h4> fcount() </h4>
Возвращает количество полей текущей таблицы.
<hr>
<h4> fieldname(FNo) </h4>
Возвращает имя поля по его порядковому номеру. Если нет такого поля, возвращает "".<br>
<B>FNo</B> - порядковый номер требуемого поля.<br>
<hr>
<h4> fieldpos(FName) </h4>
Возвращает номер поля по его имени. Если нет такого поля, возвращает 0.<br>
<B>FName</B> - имя требуемого поля.<br>
<hr>
<h4> found() </h4>
Возвращает результат последнего поиска - <B>.t.</B>, если в результате <b>seek()</b>,
<b>locate()</b> или <b>continue()</b> найдена искомая запись, иначе <B>.f.</B>.
<hr>
<h4> getvalue(Field) </h4>
Возвращает значение указанного поля.<br>
<B>Field</B> - имя или порядковый номер требуемого поля.<br>
<hr>
<h4> gobottom() </h4>
Переход на последнюю запись файла.
<hr>
<h4> goto(Rec) </h4>
Переход на запись с указанным номером.<br>
<B>Rec</B> - физический номер записи, на которую надо перейти.
<hr>
<h4> gotokey(KeyNo) </h4>
Переход на запись с указанным порядковым номером ключа.<br>
<B>KeyNo</B> - номер ключа (логический номер записи в текущем индексе),
 на которую надо перейти.
<hr>
<h4> gotop() </h4>
Переход на первую запись файла.
<hr>
<h4> indexkey() </h4>
Возвращает индексное выражение текущего индекса.
<hr>
<h4> keyno() </h4>
Возвращает логический номер записи (в текущем индексе).
<hr>
<h4> lastkey() </h4>
Возвращает последний логический номер записи (в текущем индексе).
<hr>
<h4> locate(sExpr,sWhile,nNext,nRec,lRest) </h4>
Производит последовательный поиск записей, удовлетворяющих условию. <br>
<B>sExpr</B> - условие для поиска (строка).<br>
<B>sWhile</B> - ограничивает область поиска - поиск выполняется, пока
истинно условие <B>sWhile</B>.<br>
<B>nNext</B> - определяет количество записей, начиная с текущей,
используемых в процессе поиске.<br>
<B>nRec</B> - номер обрабатываемой записи. Если задан, поиск проводится
только в указанной записи.<br>
<B>lRest</B> - если указан этот параметр, и равен <B>.T.</B>, поиск идет с
текущей записи до конца файла, иначе обрабатывается весь файл.<br>
<hr>
<h4> lastrec() </h4>
Возвращает последний физический номер записи.
<hr>
<h4> open(Driver,Name,Shared,ReadOnly) </h4>
Открывает файл с указанным именем.
Атрибут <b>handle</b> принимает значение дескриптора открытого файла.<br>
<B>Driver</B> - имя RDD-драйвера данных.<br>
<B>Name</B> - имя файла таблицы данных.<br>
<B>Shared</B> - логическое значение, определяющее, открывать таблицу в
разделяемом режиме (<b>Shared=.t.</b>) или в эксклюзивном (<b>Shared=.f.</b>)<br>
<B>ReadOnly</B> - логическое значение, определяющее, открывать таблицу <br>
только для чтения (<b>ReadOnly=.t.</b>) или для чтения и записи (<b>ReadOnly=.f.</b>)<br>
<hr>
<h4> read() </h4>
Читает запись. Возвращает объект, содержащий данные текущей записи.
Структура объекта копируется из структуры записи, т. е. каждое поле становится
атрибутом объекта.<br>
Пример:<br>
<PRE>
  R:=RDDNew("DBF","table1.dbf")
  Rec:=R:read()
  ? "Field1 is "
  ?? Rec:Field1
  ? "Field2 is "
  ?? Rec:Field2
</PRE>
<hr>
<h4> recall() </h4>
Восстанавливает запись, помеченную для удаления.
<hr>
<h4> recno() </h4>
Возвращает физический номер записи.
<hr>
<h4> reindex() </h4>
Пересоздает открытые индексы.
<hr>
<h4> rlock([nRecno],[lReleaseLocks]) -> lSuccess </h4>
Устанавливает блокировку записи с номером <b>nRecno<b>. Если параметр
<b>nRecno<b> не указан, блокируется текущая запись. Параметр <b>lReleaseLocks<b>
определяет, снимать при этом блокировки остальных записей или нет. По умолчанию
<b>lReleaseLocks = .T.<b>
<hr>
<h4> runlock([nRecno]) </h4>
Снимает блокировку записи с номером <b>nRecno<b>. Если параметр
<b>nRecno<b> не указан, снимается блокировка текущей записи. Если <b>nRecno = 0<b>,
снимаются блокировки всех записей.
<hr>
<h4> seek(Key,Soft,Last) </h4>
Ищет в индексном файле ключ с заданным значением.<br>
<B>Key</B> - значение искомого ключа.<br>
<B>Soft</B> - логическое значение, определяющее поведение указателя записи
в случае безуспешного поиска. Если <B>Soft=.t.</B>, указатель устанавливается
на ближайшую запись с ключом, большим искомого, если же <B>Soft=.f.</B>,
указатель устанавливается на конец записи.<br>
<B>Last</B> - если <B>Last=.t.</B>, то в случае нахождения нескольких записей
с искомым ключом указатель устанавливается на последнюю из них.<br>
<hr>
<h4> setfilter(Condition) </h4>
Устанавливает фильтр. Скрывает записи, не удовлетворяющие условию.<br>
<B>Condition</B> - требуемое условие.
<hr>
<h4> setindex(Driver,Name,Tag) </h4>
Открывает индексный файл.<br>
<B>Driver</B> - имя RDD-драйвера индексного файла.<br>
<B>Name</B> - имя файла таблицы данных.<br>
<B>Tag</B> - имя тэга индекса.<br>
<hr>
<h4> setmemo() </h4>
<hr>
<h4> setorder(Tag) </h4>
Устанавливает управляющий индекс и тэг.<br>
<B>Tag</B> - номер индекса (номер тэга или его имя), который становится
управляющим для данной таблицы.
<hr>
<h4> indexord() </h4>
Возвращает номер текущего индекса.<br>
<hr>
<h4> setrelation(Child,Expr) </h4>
Устанавливет связь между двумя таблицами данных. При этом дочерняя таблица
должна быть проиндексирована. При перемещении указателя в родительской таблице
в дочернеей производится поиск по индексу указанного выражения.<br>
<B>Child</B> - объект RDD, дочерняя таблица.<br>
<B>Expr</B> - выражение, вычисляемое для родительской таблицы.
Результат вычисления ищется по индексу в дочерней таблице.<br>
<hr>
<h4> setvalue(Field,Value) </h4>
Устанавливает значение указанного поля.<br>
<B>Field</B> - имя или порядковый номер требуемого поля.<br>
<B>Value</B> - значение, записываемое в поле.<br>
<hr>
<h4> skip(NumRecs) </h4>
Перемещает указатель текущей записи вперед или назад относительно текущего положения.<br>
<B>NumRecs</B> - количество записей, на которое надо переместиться. Если <B>NumRecs</B>
больше нуля, указатель перемещается вперед, если меньше нуля - назад.<br>
<hr>
<h4> struct() </h4>
Возвращает двумерный массив, содержащий структуру открытой таблицы данных.
Каждый элемент массива содержит имя поля, тип его данных, размер и количество
знаков в дробной части для числовых полей.
<hr>
<h4> write(Rec) </h4>
Записывает данные в текущую запись.<br>
<B>Rec</B> - объект, соответствующий записываемым данным.
При соответствии имени атрибута и имени поля таблицы его значение
записывается в поле.<br>
<hr>
<h4> zap() </h4>
Удаляет все записи из таблицы.
<hr>
<center>&#169 Алексей М. Ткаченко, <A HREF="mailto:alexey@itk.ru">alexey@itk.ru</A>, 2001
</center>
</BODY>
</html>
